<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Polizei-Chat | Identifizierung</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      margin: 0;
      background: #0a0f1a;
      font-family: "Segoe UI", sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      color: white;
    }
    #chat {
      width: 380px;
      height: 640px;
      background: #101826;
      border: 2px solid #1f3b68;
      border-radius: 20px;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      box-shadow: 0 0 25px rgba(0, 0, 0, 0.7);
    }
    #header {
      background: linear-gradient(90deg, #001b44, #003366);
      padding: 12px 16px;
      border-bottom: 1px solid #264673;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    #header::before { content: "üëÆ‚Äç‚ôÇÔ∏è"; }
    #messages {
      flex: 1;
      padding: 12px;
      overflow-y: auto;
      background: #0d1420;
      display: flex;
      flex-direction: column;
    }
    .msg {
      margin: 6px 0;
      padding: 10px 14px;
      border-radius: 16px;
      max-width: 75%;
      line-height: 1.3;
      word-wrap: break-word;
      animation: fadeIn 0.3s ease-in;
    }
    .bot {
      background: #1a2e4a;
      align-self: flex-start;
      color: #e1ecff;
      border: 1px solid #2b4b78;
    }
    .you {
      background: #004aad;
      align-self: flex-end;
      color: #fff;
      border: 1px solid #0b63d1;
    }
    .timestamp {
      font-size: 10px;
      color: #8fa3c2;
      margin-top: 4px;
      text-align: right;
    }
    #inputArea {
      display: flex;
      border-top: 1px solid #1c355a;
      background: #14233b;
    }
    #inputArea input {
      flex: 1;
      border: none;
      padding: 12px;
      background: transparent;
      color: white;
      font-size: 14px;
      outline: none;
    }
    #inputArea button {
      background: #004aad;
      border: none;
      color: white;
      padding: 0 18px;
      font-weight: 600;
      cursor: pointer;
    }
    .document {
      display: flex;
      align-items: center;
      background: #182a44;
      border: 1px solid #2b4b78;
      border-radius: 10px;
      padding: 8px 10px;
      color: #d6e3ff;
      text-decoration: none;
      gap: 10px;
    }
    .document:hover { background: #223b61; }
    .document::before {
      content: "üìÑ";
      font-size: 18px;
    }
    .voice {
      display: flex;
      align-items: center;
      gap: 10px;
      background: #16253d;
      padding: 8px 10px;
      border-radius: 12px;
      border: 1px solid #2b4b78;
    }
    .playBtn {
      width: 26px;
      height: 26px;
      border-radius: 50%;
      border: 2px solid #9db6e3;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    .playBtn svg {
      width: 10px;
      height: 10px;
      fill: #9db6e3;
    }
    @keyframes fadeIn {
      from {opacity: 0; transform: translateY(5px);}
      to {opacity: 1; transform: translateY(0);}
    }
  </style>
</head>
<body>
  <div id="chat">
    <div id="header">Polizei ‚Äì Einsatzleitung</div>
    <div id="messages"></div>
    <div id="inputArea">
      <input id="userInput" placeholder="Nachricht eingeben..." />
      <button id="sendBtn">Senden</button>
    </div>
  </div>

  <script>
    const messages = document.getElementById('messages');
    const userInput = document.getElementById('userInput');
    const sendBtn = document.getElementById('sendBtn');

    let userName = null;
    let step = 0;

    // Hilfsfunktionen
    function getTime() {
      const d = new Date();
      return d.toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'});
    }

    function addMessage(text, sender='bot', html=false) {
      const msg = document.createElement('div');
      msg.classList.add('msg', sender);
      msg.innerHTML = html ? text : text.replace(/\n/g, '<br>');
      const time = document.createElement('div');
      time.classList.add('timestamp');
      time.textContent = getTime();
      msg.appendChild(time);
      messages.appendChild(msg);
      messages.scrollTop = messages.scrollHeight;
    }

    function addVoiceMessage(text) {
      const msg = document.createElement('div');
      msg.classList.add('msg', 'bot');
      msg.innerHTML = `
        <div class="voice">
          <div class="playBtn" title="Abspielen">
            <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
          </div>
          <div>Sprachnachricht ‚Äì 0:17</div>
        </div>
      `;
      msg.querySelector('.playBtn').addEventListener('click', () => {
        const utter = new SpeechSynthesisUtterance(text);
        utter.lang = 'de-DE';
        speechSynthesis.cancel();
        speechSynthesis.speak(utter);
      });
      messages.appendChild(msg);
      messages.scrollTop = messages.scrollHeight;
    }

    function addDocumentLink() {
      const msg = document.createElement('div');
      msg.classList.add('msg', 'bot');
      msg.innerHTML = `<a class="document" href="akte.html">Fallakte_Christmaskill.pdf</a>`;
      messages.appendChild(msg);
      messages.scrollTop = messages.scrollHeight;
    }

    // Story-Ablauf
    function nextStep(input) {
      switch(step) {
        case 0:
          addMessage("Hey Hauptkomissarin Odentief hier, Einsatzleiterin der Soko 'Christmaskill' Schweinfurt. Ich hab geh√∂rt du bist unsere neue Kollegin, wir duzen uns hier alle, wie ist dein Name?.");
          step = 1;
          break;

        case 1:
          userName = input;
          localStorage.setItem('ermittlerName', userName);
          addMessage(`Verstanden, ${userName}. Die Lage ist ernst.`, 'bot');
          setTimeout(() => {
            addMessage("Ich schick dir schnell eine Sprachnachricht von Oberkomissarin Schulze, die hat uns zur Hilfe rangezogen", 'bot');
            setTimeout(() => {
              addVoiceMessage("Als wir am Tatort ankamen, fanden wir den Weihnachtsmann leblos vor dem Kamin liegen. Es gab Anzeichen von Kampf, und merkw√ºrdigen Geruch von Zimt und verbranntem Wachs. Wir haben rote Stofffetzen an der T√ºrklinke und am Kamin entdeckt, sowie Fu√üspuren im Schnee, die vom Hintereingang bis zum Kaminfenster f√ºhren. Wir vermuten, dass jemand in roter Kleidung involviert ist. Deine Aufgabe ist es, die Beweise zu analysieren und herauszufinden, wer den Weihnachtsmann zuletzt lebend gesehen hat. Viel Erfolg!");
              setTimeout(() => {
                addMessage("√ñffne danach die Akte ‚Äì und bleibe diskret.", 'bot');
                setTimeout(addDocumentLink, 1200);
              }, 3500);
            }, 1500);
          }, 1200);
          step = 2;
          break;

        default:
          addMessage("Weitere Informationen finden Sie in der Akte.", 'bot');
      }
    }

    // User Input
    sendBtn.addEventListener('click', () => {
      const text = userInput.value.trim();
      if (!text) return;
      addMessage(text, 'you');
      userInput.value = '';
      setTimeout(() => nextStep(text), 800);
    });
    userInput.addEventListener('keyup', e => {
      if (e.key === 'Enter') sendBtn.click();
    });

    // Start
    nextStep();
  </script>
</body>
</html>
